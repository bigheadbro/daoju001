<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="question">
	<resultMap type="QuestionEntity" id="QuestionResultMap">
	  <!---->
		<id property="id" column="id" />
		<!--问题名称 -->
		<id property="type" column="type" />
		<!--问题内容 -->
		<id property="content" column="content" />
		<!--买家id -->
		<id property="buyerId" column="buyer_id" />
		<!--专业回答数量 -->
		<id property="cntPA" column="cnt_PA" />
		<!--普通回答数量 -->
		<id property="cntCA" column="cnt_CA" />
		<!--0=已发布，1=草稿 -->
		<id property="state" column="state" />
		<!--记录创建时间 -->
		<id property="gmtCreate" column="gmt_create" />
		<!--记录修改时间 -->
		<id property="gmtModify" column="gmt_modify" />
		<!---->
		<id property="industry" column="industry"/>
			  <!---->
		<id property="processMethod" column="process_method"/>
			  <!---->
		<id property="wpHardness" column="wp_hardness"/>
			  <!---->
		<id property="wpMaterial" column="wp_material"/>
			  <!---->
		<id property="hasPic" column="has_pic"/>
	</resultMap>

	<select id="queryQuestionEntityById" parameterType="int"
		resultMap="QuestionResultMap">
	<![CDATA[
		SELECT * from t_question t WHERE t.id = #{id}
	]]>
	</select>

	<insert id="insertQuestionEntity" parameterType="QuestionEntity">
		<selectKey resultType="int" order="AFTER" keyProperty="id">
			SELECT LAST_INSERT_ID() AS id
		</selectKey>
		insert into t_question
		(
		type
		,content
		,buyer_id
		,cnt_PA
		,cnt_CA
		,state
		,gmt_create
		,gmt_modify
		,industry
		,process_method
		,wp_hardness
		,wp_material
		,has_pic)
		values
		(
		#{type}
		,#{content}
		,#{buyerId}
		,#{cntPA}
		,#{cntCA}
		,#{state}
		,#{gmtCreate}
		,#{gmtModify}
		,#{industry}
		,#{processMethod}
		,#{wpHardness}
		,#{wpMaterial}
		,#{hasPic}
		)
	</insert>

	<select id="queryQuestionsByUserId" parameterType="int"
			resultMap="QuestionResultMap">
		<![CDATA[
			SELECT * from t_question t where t.state = 1 and t.buyer_id=#{id} order by gmt_create desc
		]]>
	</select>
	
	<select id="queryDraftsByUserId" parameterType="int"
			resultMap="QuestionResultMap">
		<![CDATA[
			SELECT * from t_question t where t.state = 0 and t.buyer_id=#{id} order by gmt_create desc
		]]>
	</select>
	
	<update id="updateTitleById" parameterType="QuestionEntity">
		update t_question
		set title = #{type}, gmt_modified=now() where id=#{id}
	</update>
</mapper>