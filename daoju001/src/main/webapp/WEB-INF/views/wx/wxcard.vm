<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head>
        <script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
        <link rel="stylesheet" href="/css/jquery.mobile-1.3.2.min.css">
        <script src="/js/jquery.mobile-1.3.2.min.js"></script>
		<script type="text/javascript" src="/js/jquery-scrolltofixed-min.js"></script>
		<script type="text/javascript" src="/js/iscroll.js"></script>
        <link rel="stylesheet" href="/css/wap.css">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
		<script>
		function onBridgeReady(){
         WeixinJSBridge.call('showOptionMenu');
        }
        
        if (typeof WeixinJSBridge == "undefined"){
            if( document.addEventListener ){
                document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
            }else if (document.attachEvent){
                document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
                document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
            }
        }else{
            onBridgeReady();
        }
		</script>
	</head>
    <body>
		<div class="share-mask">
			<img src="/img/wx/sharecard.png" />
		</div>
		<div data-role="page" data-theme="z" class="scroll">
			<div class="cardview">
    			<div class="wx-info clearfix">
                    <div class="avatar">
						#if($stringUtil.isNotEmpty(${user.wxlogo}))
							<img src="${user.wxlogo}" />
						#else
							<img src="/img/wx/wxavatar.png" />
						#end
                    </div>
                    <div class="content">
                    	<h1>
							#if($stringUtil.isNotEmpty(${user.contactName}))
								${user.contactName} 
							#else
								${user.nick}
							#end
						</h1>
                    	<h3>
							#if($stringUtil.isNotEmpty(${user.companyName}))
								${user.companyName} 
							#else
								无公司信息
							#end
						</h3>
						#if($stringUtil.isNotEmpty(${user.position}))
							<h3>${user.position}</h3>
						#end
                    	<h4>$!{user.pca}</h4>
                    </div>
    			</div>
    			<div class="range clearfix">
                    <ul>
                    	<a>
                    		<h4>全国排名</h4>
                    		<h2>${rank}</h2>
                    	</a>
                    	<a target="_blank" rel="external" href="/wxilike" data-role="none">
                    		<h4>人脉</h4>
                    		<h2>${relationcount}</h2>
                    	</a>
                    	<li>
                    		<h4>被查看</h4>
                    		<h2>${user.cntRead}</h2>
                    	</li>
                    </ul>
    			</div>
    			<div class="phone">
					<p>
						#if($stringUtil.isNotEmpty(${user.phone}))
							<a href="tel://${user.phone}">${user.phone}</a>
						#end
						&nbsp;
						#if($stringUtil.isNotEmpty(${user.contactPhone}))
							<a href="tel://${user.contactPhone}">${user.contactPhone}</a>
						#end
						#if($stringUtil.isEmpty(${user.phone}) && $stringUtil.isEmpty(${user.contactPhone}))
							无电话信息
						#end
					</p>
    			</div>
    			<div class="mail">
					<p>${user.mail}</p>
    			</div>
				<div class="brand clearfix">
					<p>
						<span>品牌</span>
						#if($stringUtil.isEmpty(${user.wxbrand}))
							#if(${user.brand} > 0)
								$stringUtil.getBrand(${user.brand})
							#end
							#if(${user.brand2} > 0)
								,$stringUtil.getBrand(${user.brand2})
							#end
							#if(${user.brand} == 0  && ${user.brand2} == 0)
								无品牌信息
							#end
						#else
							${user.wxbrand}
						#end
					</p>
				</div>
				<a class="product">
					<span>我的特色刀具</span>
				</a>				
			</div>
			<div data-role="footer" data-position="fixed" data-theme="z" class="bottom-op">
				<div class="left">
					<p class="share">分享我的名片</p>
				</div>
				<div class="right">
					<ul>
    					<a target="_blank" rel="external" href="/wxsearch" data-role="none">搜索供应商</a>
    					<a target="_blank" rel="external" href="/wxilike" data-role="none">刀具人脉</a>
    					<a target="_blank" rel="external" href="/wxprofile" data-role="none">修改信息</a>
					</ul>
					<p class="more">更多</p>
				</div>
			</div>
		</div>
		<script>
			var visibleMore = false;
			$(function() {
            	$(".more").click(function() {
            		if (visibleMore) {
            			$(".right ul").fadeOut();//removeAttr("style");
            			visibleMore = false;
            		} else {
            			$(".right ul").fadeIn();//css("visibility", "visible");
            			visibleMore = true;
            		}
            	});
            	$(".share").click(function() {
            		if (visibleMore) {
            			$(".more").trigger("click");
            		}
            		$(".share-mask").css("visibility", "visible");
            	});
            
            	$(".share-mask").click(function() {
            		$(".share-mask").removeAttr("style");
            	});
            	
            	myscroll = new iScroll("wrapper", {
            		hScrollbar : false
            	});
            });
			var imgUrl = '${user.wxlogo}';
            var lineLink = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb5f0887883f34822&redirect_uri=http://115017.ichengyun.net/wxcard/${user.id}&response_type=code&scope=snsapi_base&state=s1#wechat_redirect';
            var descContent = "${user.contactName}\n${user.companyName}\n${user.pca}\n点击我了解更多信息";
            var shareTitle = "${user.contactName}的刀具名片";
            var appid = 'wxb5f0887883f34822';
            
            function shareFriend() {
            	WeixinJSBridge.invoke('sendAppMessage', {
            		"appid" : appid,
            		"img_url" : imgUrl,
            		"img_width" : "640",
            		"img_height" : "640",
            		"link" : lineLink,
            		"desc" : descContent,
            		"title" : shareTitle
            	}, function(res) {
            		_report('send_msg', res.err_msg);
            	});
            }
            function shareTimeline() {
            	WeixinJSBridge.invoke('shareTimeline', {
            		"img_url" : imgUrl,
            		"img_width" : "640",
            		"img_height" : "640",
            		"link" : lineLink,
            		"desc" : descContent,
            		"title" : shareTitle
            	}, function(res) {
            		_report('timeline', res.err_msg);
            	});
            }
            // 当微信内置浏览器完成内部初始化后会触发WeixinJSBridgeReady事件。
            document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
            
            	// 发送给好友
            	WeixinJSBridge.on('menu:share:appmessage', function(argv) {
            		shareFriend();
            	});
            
            	// 分享到朋友圈
            	WeixinJSBridge.on('menu:share:timeline', function(argv) {
            		shareTimeline();
            	});
            
            }, false);
		</script>
		<script type="text/javascript" src="/js/wx.js"></script>
    </body>
</html>
